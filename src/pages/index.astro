---
import "../styles/style.css";
import Gallery3D from "../components/Gallery3D.astro";
import ArchiveTable from "../components/ArchiveTable.astro";
import Header from "../components/Header.astro";
import Footer from "../components/Footer.astro";
---

<html lang="it">
	<head>
		<meta charset="utf-8" />
		<link rel="icon" type="image/svg+xml" href="/favicon.svg" />
		<meta name="viewport" content="width=device-width" />
		<meta name="generator" content={Astro.generator} />
		<link rel="preconnect" href="https://fonts.googleapis.com" />
		<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
		<link
			href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap"
			rel="stylesheet"
		/>
		<title>Pixar Viz</title>
	</head>
	<body>
		<div id="custom-cursor"></div>
		<Header />

		<div id="gallery-view" class="view active">
			<Gallery3D />
		</div>

		<div id="archive-view" class="view">
			<ArchiveTable />
			<Footer />
		</div>

		<script>
			// Custom cursor
			const cursor = document.getElementById("custom-cursor");
			let is3DHovering = false;

			// Listen for 3D hover events from Gallery3D
			window.addEventListener("3d-hover", ((e: CustomEvent) => {
				is3DHovering = e.detail.isHovering;
			}) as EventListener);

			document.addEventListener("mousemove", e => {
				if (!cursor) return;

				cursor.style.left = e.clientX + "px";
				cursor.style.top = e.clientY + "px";

				// Get element under cursor (cursor has pointer-events: none so it's ignored)
				const elementUnderCursor = document.elementFromPoint(
					e.clientX,
					e.clientY
				);

				// Check if it's an interactive element
				let isInteractive = false;

				if (elementUnderCursor && elementUnderCursor !== cursor) {
					isInteractive =
						elementUnderCursor.tagName === "BUTTON" ||
						elementUnderCursor.tagName === "A" ||
						elementUnderCursor.tagName === "INPUT" ||
						elementUnderCursor.tagName === "SELECT" ||
						elementUnderCursor.tagName === "TEXTAREA" ||
						!!elementUnderCursor.closest("button, a, input, select, textarea");
				}

				// Also consider 3D hover state
				if (isInteractive || is3DHovering) {
					cursor.classList.add("hover");
				} else {
					cursor.classList.remove("hover");
				}
			});

			// Toggle view logic - listen to events from Header component
			const galleryView = document.getElementById("gallery-view");
			const archiveView = document.getElementById("archive-view");

			window.addEventListener("viewToggle", ((e: CustomEvent) => {
				const isTableView = e.detail.isTableView;

				if (isTableView) {
					galleryView?.classList.remove("active");
					archiveView?.classList.add("active");
				} else {
					galleryView?.classList.add("active");
					archiveView?.classList.remove("active");
				}
			}) as EventListener);
		</script>

		<style>
			.view {
				display: none;
			}

			.view.active {
				display: block;
			}
		</style>
	</body>
</html>
