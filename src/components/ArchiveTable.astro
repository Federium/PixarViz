---
// Carica i dati dal file JSON locale
import galleryData from "../data/pixarviz_cover.json";

// Prepara i dati con percorsi ottimizzati per WebP
const processedData = galleryData.map(item => {
	const filename = item.SRC.split("/").pop() || "";
	const extPattern = new RegExp("\\.(jpg|jpeg|png|webp|avif)$", "i");
	const nameWithoutExt = filename.replace(extPattern, "");

	return {
		...item,
		optimizedSrc: `/images/${nameWithoutExt}.webp`,
	};
});
---

<div class="archive-container">
	<table class="archive-table">
		<thead>
			<tr>
				<th>ID</th>
				<th>Preview</th>
				<th>Name</th>
				<th>Category</th>
				<th></th>
			</tr>
		</thead>
		<tbody>
			{
				processedData.map(item => (
					<tr class="archive-row" data-id={item.ID}>
						<td class="archive-id">{item.ID}</td>
						<td class="archive-preview">
							<img src={item.optimizedSrc} alt={item.NAME} loading="lazy" />
						</td>
						<td class="archive-name">{item.NAME}</td>
						<td class="archive-category">{item.CATEGORY}</td>
						<td class="archive-action">
							<a href={`/film/${item.ID}`} class="view-btn">
								VIEW
							</a>
						</td>
					</tr>
				))
			}
		</tbody>
	</table>
</div>

<style>
	.archive-container {
		width: 100%;
		min-height: 100vh;
		padding: 4rem 2rem 2rem 2rem;
		overflow-x: auto;
		margin-top: 20vh;
	}

	.archive-table {
		width: 100%;
		border-collapse: collapse;
		font-family:
			"Inter",
			-apple-system,
			BlinkMacSystemFont,
			"Segoe UI",
			"Roboto",
			"Helvetica Neue",
			Arial,
			sans-serif;
	}

	.archive-table thead {
		background: transparent;
		color: #000000;
	}

	.archive-table th {
		padding: 1rem 1rem 1rem 0;
		text-align: left;
		font-weight: 900;
		text-transform: uppercase;
		letter-spacing: 0.15em;
		font-size: 0.75rem;
		border: none;
		border-bottom: 3px solid #000000;
	}

	.archive-table tbody tr {
		border: none;
		border-bottom: 1px solid #000000;
		transition: none;
	}

	.archive-table tbody tr:hover {
		background: transparent;
	}

	.archive-table tbody tr:hover .archive-name {
		text-decoration: underline;
		text-decoration-thickness: 3px;
	}

	.archive-table tbody tr:last-child {
		border-bottom: 3px solid #000000;
	}

	.archive-table td {
		padding: 1.5rem 1rem 1.5rem 0;
		vertical-align: middle;
		border: none;
	}

	.archive-id {
		font-weight: 900;
		font-size: 1.5rem;
		width: 100px;
	}

	.archive-preview {
		width: 100px;
	}

	.archive-preview img {
		width: 80px;
		height: 60px;
		object-fit: cover;
		border: none;
		display: block;
		filter: grayscale(100%) contrast(1.2);
	}

	.archive-name {
		font-weight: 700;
		font-size: 1.3rem;
		text-transform: uppercase;
		letter-spacing: 0.02em;
	}

	.archive-category {
		font-weight: 400;
		font-size: 1rem;
		text-transform: uppercase;
		letter-spacing: 0.1em;
		color: #000000;
	}

	.archive-action {
		text-align: right;
		width: 150px;
	}

	.view-btn {
		display: inline-block;
		padding: 0;
		background: transparent;
		color: #000000;
		text-decoration: none;
		font-weight: 900;
		text-transform: uppercase;
		letter-spacing: 0.15em;
		font-size: 1rem;
		border: none;
		transition: none;
	}

	.view-btn:hover {
		text-decoration: underline;
		text-decoration-thickness: 3px;
	}

	@media (max-width: 768px) {
		.archive-container {
			padding: 4rem 1rem 1rem 1rem;
		}

		.archive-table {
			font-size: 0.85rem;
		}

		.archive-table th {
			padding: 0.75rem 0.5rem 0.75rem 0;
			font-size: 0.65rem;
			border-bottom: 2px solid #000000;
		}

		.archive-table td {
			padding: 1rem 0.5rem 1rem 0;
		}

		.archive-table tbody tr:last-child {
			border-bottom: 2px solid #000000;
		}

		.archive-id {
			font-size: 1.2rem;
			width: 60px;
		}

		.archive-preview {
			width: 70px;
		}

		.archive-preview img {
			width: 60px;
			height: 45px;
		}

		.archive-name {
			font-size: 1rem;
		}

		.archive-category {
			font-size: 0.85rem;
		}

		.view-btn {
			font-size: 0.85rem;
		}

		.view-btn:hover {
			text-decoration-thickness: 2px;
		}
	}
</style>
