---
// Carica i dati dal file JSON locale
import galleryData from "../data/pixarviz_cover.json";

// Prepara i dati con percorsi ottimizzati per WebP
const processedData = galleryData.map(item => {
	const filename = item.SRC.split("/").pop() || "";
	const extPattern = new RegExp("\\.(jpg|jpeg|png|webp|avif)$", "i");
	const nameWithoutExt = filename.replace(extPattern, "");

	return {
		...item,
		optimizedSrc: `/images/${nameWithoutExt}.webp`,
	};
});
---

<div class="archive-container">
	<div class="archive-list">
		{
			processedData.map(item => (
				<a
					href={`/film/${item.ID}`}
					class="archive-item"
					data-image={item.optimizedSrc}
					data-name={item.NAME}
				>
					<span class="item-id">{item.ID}</span>
					<span class="item-name">{item.NAME}</span>
					<span class="item-category">{item.CATEGORY}</span>
				</a>
			))
		}
	</div>
	<div id="hover-image" class="hover-image">
		<img src="" alt="" />
	</div>
</div>

<style>
	.archive-container {
		width: 100%;
		min-height: 100vh;
		padding: 2rem 1rem;
		margin-top: 0;
	}

	.archive-list {
		width: 100%;
	}

	.archive-item {
		display: grid;
		grid-template-columns: 80px 1fr 200px;
		gap: 2rem;
		margin: 0.5rem 0;
		text-decoration: none;
		color: #000000;
		font-family: var(--font-family);
		transition: opacity 0.2s ease;
	}

	.item-id {
		font-size: var(--font-size);
		font-weight: 600;
	}

	.item-name {
		font-size: var(--font-size);
		font-weight: 600;
		text-transform: uppercase;
		letter-spacing: 0.02em;
	}

	.item-category {
		font-size: var(--font-size);
		font-weight: 600;
		text-transform: capitalize;
		text-align: left;
	}

	.hover-image {
		position: fixed;
		pointer-events: none;
		opacity: 0;
		transition: opacity 0.3s ease;
		z-index: 1;
		transform: translate(-50%, -50%);
	}

	.hover-image.visible {
		opacity: 1;
	}

	.hover-image img {
		width: 300px;
		height: auto;
		display: block;
		object-fit: cover;
	}

	@media (max-width: 768px) {
		.archive-container {
			padding: 3rem 1rem 2rem 1rem;
		}

		.archive-item {
			grid-template-columns: 60px 1fr 120px;
			gap: 1rem;
			padding: 0.4rem 0;
		}

		.item-id,
		.item-name,
		.item-category {
			font-size: 0.7rem;
		}

		.hover-image img {
			width: 200px;
		}
	}
</style>

<script>
	const archiveItems = document.querySelectorAll(".archive-item");
	const hoverImage = document.getElementById("hover-image");
	const hoverImg = hoverImage?.querySelector("img");

	archiveItems.forEach(item => {
		item.addEventListener("mouseenter", e => {
			const target = e.currentTarget as HTMLElement;
			const imageSrc = target.getAttribute("data-image");
			const imageName = target.getAttribute("data-name");

			if (hoverImage && hoverImg && imageSrc) {
				hoverImg.src = imageSrc;
				hoverImg.alt = imageName || "";
				hoverImage.classList.add("visible");
			}
		});

		item.addEventListener("mouseleave", () => {
			if (hoverImage) {
				hoverImage.classList.remove("visible");
			}
		});

		item.addEventListener("mousemove", e => {
			const mouseEvent = e as MouseEvent;
			if (hoverImage) {
				hoverImage.style.left = mouseEvent.clientX + "px";
				hoverImage.style.top = mouseEvent.clientY + "px";
			}
		});
	});
</script>
